---
title: "MachineLearningProject"
author: "Samuel Aboelkhir"
date: "2024-06-25"
output: 
   html_document:
     toc: yes
     toc_float: yes
     keep_md: TRUE
     df_print: paged
---



# Abstract :

- In this analysis, we will be preparing a prediction model, with the purpose of predicting the quality of weight lift training for weight lifters. In the provided data, we have 5 categories describing the quality of training, where "A" is correct training, and "B" through "E" are training with common errors. The data was collected from 6 different participants with sensors attached to various parts of their body.

# Examining and cleanining the data :

- For this analysis we will be needing the caret and e1071 packages.


```r
library(caret)
```

```
## Loading required package: ggplot2
```

```
## Loading required package: lattice
```

```r
library(e1071)

pmlTrain = read.csv("pml-training.csv")
pmlTest = read.csv("pml-testing.csv")
```

- Upon examining the data, we can see multiple variables that won't be relevant in the analysis, such as time stamps, windows, and the participant names, as well as multiple variables with NA or empty ("") variables.


```r
str(pmlTrain)
```

```
## 'data.frame':	19622 obs. of  160 variables:
##  $ X                       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ user_name               : chr  "carlitos" "carlitos" "carlitos" "carlitos" ...
##  $ raw_timestamp_part_1    : int  1323084231 1323084231 1323084231 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 ...
##  $ raw_timestamp_part_2    : int  788290 808298 820366 120339 196328 304277 368296 440390 484323 484434 ...
##  $ cvtd_timestamp          : chr  "05/12/2011 11:23" "05/12/2011 11:23" "05/12/2011 11:23" "05/12/2011 11:23" ...
##  $ new_window              : chr  "no" "no" "no" "no" ...
##  $ num_window              : int  11 11 11 12 12 12 12 12 12 12 ...
##  $ roll_belt               : num  1.41 1.41 1.42 1.48 1.48 1.45 1.42 1.42 1.43 1.45 ...
##  $ pitch_belt              : num  8.07 8.07 8.07 8.05 8.07 8.06 8.09 8.13 8.16 8.17 ...
##  $ yaw_belt                : num  -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 ...
##  $ total_accel_belt        : int  3 3 3 3 3 3 3 3 3 3 ...
##  $ kurtosis_roll_belt      : chr  "" "" "" "" ...
##  $ kurtosis_picth_belt     : chr  "" "" "" "" ...
##  $ kurtosis_yaw_belt       : chr  "" "" "" "" ...
##  $ skewness_roll_belt      : chr  "" "" "" "" ...
##  $ skewness_roll_belt.1    : chr  "" "" "" "" ...
##  $ skewness_yaw_belt       : chr  "" "" "" "" ...
##  $ max_roll_belt           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_picth_belt          : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_yaw_belt            : chr  "" "" "" "" ...
##  $ min_roll_belt           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_pitch_belt          : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_yaw_belt            : chr  "" "" "" "" ...
##  $ amplitude_roll_belt     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_pitch_belt    : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_yaw_belt      : chr  "" "" "" "" ...
##  $ var_total_accel_belt    : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_roll_belt           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_roll_belt        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ var_roll_belt           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_pitch_belt          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_pitch_belt       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ var_pitch_belt          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_yaw_belt            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_yaw_belt         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ var_yaw_belt            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ gyros_belt_x            : num  0 0.02 0 0.02 0.02 0.02 0.02 0.02 0.02 0.03 ...
##  $ gyros_belt_y            : num  0 0 0 0 0.02 0 0 0 0 0 ...
##  $ gyros_belt_z            : num  -0.02 -0.02 -0.02 -0.03 -0.02 -0.02 -0.02 -0.02 -0.02 0 ...
##  $ accel_belt_x            : int  -21 -22 -20 -22 -21 -21 -22 -22 -20 -21 ...
##  $ accel_belt_y            : int  4 4 5 3 2 4 3 4 2 4 ...
##  $ accel_belt_z            : int  22 22 23 21 24 21 21 21 24 22 ...
##  $ magnet_belt_x           : int  -3 -7 -2 -6 -6 0 -4 -2 1 -3 ...
##  $ magnet_belt_y           : int  599 608 600 604 600 603 599 603 602 609 ...
##  $ magnet_belt_z           : int  -313 -311 -305 -310 -302 -312 -311 -313 -312 -308 ...
##  $ roll_arm                : num  -128 -128 -128 -128 -128 -128 -128 -128 -128 -128 ...
##  $ pitch_arm               : num  22.5 22.5 22.5 22.1 22.1 22 21.9 21.8 21.7 21.6 ...
##  $ yaw_arm                 : num  -161 -161 -161 -161 -161 -161 -161 -161 -161 -161 ...
##  $ total_accel_arm         : int  34 34 34 34 34 34 34 34 34 34 ...
##  $ var_accel_arm           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_roll_arm            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_roll_arm         : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ var_roll_arm            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_pitch_arm           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_pitch_arm        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ var_pitch_arm           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ avg_yaw_arm             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ stddev_yaw_arm          : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ var_yaw_arm             : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ gyros_arm_x             : num  0 0.02 0.02 0.02 0 0.02 0 0.02 0.02 0.02 ...
##  $ gyros_arm_y             : num  0 -0.02 -0.02 -0.03 -0.03 -0.03 -0.03 -0.02 -0.03 -0.03 ...
##  $ gyros_arm_z             : num  -0.02 -0.02 -0.02 0.02 0 0 0 0 -0.02 -0.02 ...
##  $ accel_arm_x             : int  -288 -290 -289 -289 -289 -289 -289 -289 -288 -288 ...
##  $ accel_arm_y             : int  109 110 110 111 111 111 111 111 109 110 ...
##  $ accel_arm_z             : int  -123 -125 -126 -123 -123 -122 -125 -124 -122 -124 ...
##  $ magnet_arm_x            : int  -368 -369 -368 -372 -374 -369 -373 -372 -369 -376 ...
##  $ magnet_arm_y            : int  337 337 344 344 337 342 336 338 341 334 ...
##  $ magnet_arm_z            : int  516 513 513 512 506 513 509 510 518 516 ...
##  $ kurtosis_roll_arm       : chr  "" "" "" "" ...
##  $ kurtosis_picth_arm      : chr  "" "" "" "" ...
##  $ kurtosis_yaw_arm        : chr  "" "" "" "" ...
##  $ skewness_roll_arm       : chr  "" "" "" "" ...
##  $ skewness_pitch_arm      : chr  "" "" "" "" ...
##  $ skewness_yaw_arm        : chr  "" "" "" "" ...
##  $ max_roll_arm            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_picth_arm           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_yaw_arm             : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_roll_arm            : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_pitch_arm           : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_yaw_arm             : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_roll_arm      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_pitch_arm     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ amplitude_yaw_arm       : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ roll_dumbbell           : num  13.1 13.1 12.9 13.4 13.4 ...
##  $ pitch_dumbbell          : num  -70.5 -70.6 -70.3 -70.4 -70.4 ...
##  $ yaw_dumbbell            : num  -84.9 -84.7 -85.1 -84.9 -84.9 ...
##  $ kurtosis_roll_dumbbell  : chr  "" "" "" "" ...
##  $ kurtosis_picth_dumbbell : chr  "" "" "" "" ...
##  $ kurtosis_yaw_dumbbell   : chr  "" "" "" "" ...
##  $ skewness_roll_dumbbell  : chr  "" "" "" "" ...
##  $ skewness_pitch_dumbbell : chr  "" "" "" "" ...
##  $ skewness_yaw_dumbbell   : chr  "" "" "" "" ...
##  $ max_roll_dumbbell       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_picth_dumbbell      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ max_yaw_dumbbell        : chr  "" "" "" "" ...
##  $ min_roll_dumbbell       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_pitch_dumbbell      : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ min_yaw_dumbbell        : chr  "" "" "" "" ...
##  $ amplitude_roll_dumbbell : num  NA NA NA NA NA NA NA NA NA NA ...
##   [list output truncated]
```

- By examining the variables with NA values, we can see that they are mostly NA, and an imputation approach won't be possible. In the test set, the same variables were 100% NA.

- As such, using the following code, we can modify both sets to remove all the variables that have NA values, as well as subset all the variables that don't seem relevant to the analysis out of the data sets.

- We will also be converting the "classe" variable into a factor variable.


```r
pmlTrain[pmlTrain == ""] = NA
pmlTrain = pmlTrain[,!sapply(pmlTrain, anyNA)]
pmlTrainSub = subset(pmlTrain, select = -c(user_name,num_window, new_window, cvtd_timestamp, raw_timestamp_part_2, raw_timestamp_part_1, X))
pmlTrainSub$classe = factor(pmlTrainSub$classe)

pmlTest[pmlTest == ""] = NA
pmlTest = pmlTest[,!sapply(pmlTest, anyNA)]
pmlTestSub =subset(pmlTest, select = -c(num_window, new_window, cvtd_timestamp, raw_timestamp_part_2, raw_timestamp_part_1))
```

# Choosing predictors, and deciding on a model :

- Next up, we need to figure out which predictors and model we will be using.

- In order to do that, we can combine those steps, by using a random forest model with all the predictors selected and the "importance" parameter being set to true.

- We can also add a 10-k fold cross validation training control to the model to ensure we have done sufficient resampling, while maintaining a good balance of bias and variance.


```r
ctrl  <- trainControl(method  = "cv",number  = 10)

rfFit = train(classe~., method = "rf", data = pmlTrainSub, trControl = ctrl, importance = T)

varImp(rfFit, scale = F)
```

```
## rf variable importance
## 
##   variables are sorted by maximum importance across the classes
##   only 20 most important variables shown (out of 52)
## 
##                       A     B     C     D     E
## yaw_belt          37.93 40.21 31.63 39.45 25.97
## roll_belt         29.73 35.54 36.99 35.83 29.17
## pitch_belt        30.12 36.39 31.95 30.17 31.09
## magnet_dumbbell_z 32.42 31.68 35.24 29.02 29.55
## roll_arm          24.82 34.79 31.10 29.80 27.52
## magnet_dumbbell_y 26.75 29.03 34.28 28.73 26.37
## accel_belt_z      24.02 32.72 29.91 28.27 26.69
## accel_dumbbell_y  25.94 30.44 28.89 29.54 27.79
## pitch_forearm     25.04 30.40 29.28 29.40 28.56
## yaw_arm           22.61 29.91 28.12 29.02 25.36
## accel_dumbbell_z  25.64 28.17 27.97 27.05 29.58
## magnet_dumbbell_x 22.49 24.23 29.48 23.35 21.39
## gyros_forearm_y   20.69 29.38 27.14 28.10 23.49
## magnet_belt_z     27.18 29.33 28.27 29.03 26.68
## magnet_forearm_z  22.92 28.65 27.03 29.14 25.88
## gyros_belt_z      23.05 29.11 25.25 26.39 27.71
## gyros_dumbbell_z  23.25 29.09 26.62 26.96 24.96
## magnet_belt_y     23.52 28.73 28.23 27.40 25.36
## gyros_dumbbell_y  24.23 26.63 28.72 26.67 24.42
## accel_arm_y       24.41 28.43 24.94 24.09 24.93
```

```r
predict(rfFit,pmlTestSub)
```

```
##  [1] B A B A A E D B A A B C B A E E A B B B
## Levels: A B C D E
```


```r
rfFit
```

```
## Random Forest 
## 
## 19622 samples
##    52 predictor
##     5 classes: 'A', 'B', 'C', 'D', 'E' 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 17660, 17661, 17659, 17659, 17659, 17659, ... 
## Resampling results across tuning parameters:
## 
##   mtry  Accuracy   Kappa    
##    2    0.9952601  0.9940042
##   27    0.9949034  0.9935532
##   52    0.9898068  0.9871059
## 
## Accuracy was used to select the optimal model using the largest value.
## The final value used for the model was mtry = 2.
```
# Evaluating the results :

- The model proved to be suitable for the problem at hand, with an accuracy score and kappa of 0.99, and from the cross-validation, we can be confident that it's not biased or overfitted.

- The varImp function also showed that all the predictors were significant for the model.

- The predictions from the test set were then cross-referenced with accompanying quiz's results, and the results showed a 100% prediction accuracy.

- As for the out of sample error, it can be estimated by taking the mean of the calculated accuracies, and subtracting the outcome from 1.


```r
1- mean(rfFit$results[,"Accuracy"])
```

```
## [1] 0.006676576
```
# Session info :


```r
sessionInfo()
```

```
## R version 4.4.1 (2024-06-14)
## Platform: x86_64-pc-linux-gnu
## Running under: Ubuntu 22.04.4 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## time zone: Africa/Cairo
## tzcode source: system (glibc)
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] e1071_1.7-14   caret_6.0-94   lattice_0.22-6 ggplot2_3.5.1 
## 
## loaded via a namespace (and not attached):
##  [1] gtable_0.3.5         xfun_0.43            bslib_0.7.0         
##  [4] recipes_1.0.10       vctrs_0.6.5          tools_4.4.1         
##  [7] generics_0.1.3       stats4_4.4.1         parallel_4.4.1      
## [10] proxy_0.4-27         tibble_3.2.1         fansi_1.0.6         
## [13] pkgconfig_2.0.3      ModelMetrics_1.2.2.2 Matrix_1.7-0        
## [16] data.table_1.15.4    lifecycle_1.0.4      compiler_4.4.1      
## [19] stringr_1.5.1        munsell_0.5.1        codetools_0.2-20    
## [22] htmltools_0.5.8.1    class_7.3-22         sass_0.4.9          
## [25] yaml_2.3.8           prodlim_2023.08.28   pillar_1.9.0        
## [28] jquerylib_0.1.4      MASS_7.3-61          cachem_1.0.8        
## [31] gower_1.0.1          iterators_1.0.14     rpart_4.1.23        
## [34] foreach_1.5.2        nlme_3.1-165         parallelly_1.37.1   
## [37] lava_1.8.0           tidyselect_1.2.1     digest_0.6.35       
## [40] stringi_1.8.3        future_1.33.2        dplyr_1.1.4         
## [43] reshape2_1.4.4       purrr_1.0.2          listenv_0.9.1       
## [46] splines_4.4.1        fastmap_1.1.1        grid_4.4.1          
## [49] colorspace_2.1-0     cli_3.6.2            magrittr_2.0.3      
## [52] survival_3.6-4       utf8_1.2.4           future.apply_1.11.2 
## [55] withr_3.0.0          scales_1.3.0         lubridate_1.9.3     
## [58] timechange_0.3.0     rmarkdown_2.26       globals_0.16.3      
## [61] nnet_7.3-19          timeDate_4032.109    evaluate_0.23       
## [64] knitr_1.46           hardhat_1.4.0        rlang_1.1.4         
## [67] Rcpp_1.0.12          glue_1.7.0           pROC_1.18.5         
## [70] ipred_0.9-14         rstudioapi_0.16.0    jsonlite_1.8.8      
## [73] R6_2.5.1             plyr_1.8.9
```
